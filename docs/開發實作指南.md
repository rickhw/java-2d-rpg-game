# M/A Legend - 開發實作指南 (Development Implementation Guide)

## 1. 視覺設計規範

### 1.1 像素藝術標準
```
基礎規格：
- 原始瓦片大小：16x16 像素
- 縮放倍數：4倍 (顯示為64x64)
- 色彩深度：24位元 RGB
- 調色板：限制使用16色調色板以保持一致性

角色精靈規格：
- 角色大小：16x24 像素 (寬x高)
- 動畫幀數：行走4幀，攻擊3幀，受傷1幀
- 方向：上下左右4個方向
- 檔案格式：PNG (透明背景)
```

### 1.2 UI設計規範
```
介面元素：
- 對話框：480x120 像素，圓角4像素
- 按鈕：標準按鈕 120x32 像素
- 生命值條：每個心形 32x32 像素
- 字體：主要使用 "MaruMonica" 像素字體
- 文字大小：對話 18pt，UI標籤 14pt

顏色規範：
- 主色調：#2E4057 (深藍灰)
- 強調色：#F39C12 (橙黃)
- 成功色：#27AE60 (綠色)
- 危險色：#E74C3C (紅色)
- 背景色：#34495E (中性灰)
```

### 1.3 動畫規範
```
動畫標準：
- 行走動畫：每幀持續 10 遊戲幀 (1/6秒)
- 攻擊動畫：每幀持續 5 遊戲幀 (1/12秒)
- 受傷閃爍：紅色覆蓋，持續 30 遊戲幀 (0.5秒)
- 過場動畫：淡入淡出 60 遊戲幀 (1秒)

緩動效果：
- 選單滑入：EaseOutQuart
- 血條變化：EaseOutCubic
- 攝影機移動：EaseInOutSine
```

## 2. 音效設計規範

### 2.1 音效檔案清單
```
背景音樂 (BGM)：
- title.wav：標題畫面音樂 (循環)
- overworld.wav：世界地圖音樂 (循環)
- dungeon.wav：地下城音樂 (循環)
- boss.wav：Boss戰音樂 (循環)
- ending.wav：結局音樂 (單次播放)

音效 (SE)：
- cursor.wav：選單游標移動
- confirm.wav：確認操作
- cancel.wav：取消操作
- attack.wav：玩家攻擊
- hit.wav：攻擊命中
- damage.wav：玩家受傷
- pickup.wav：撿取物品
- door.wav：開門音效
- chest.wav：開寶箱音效
- levelup.wav：升級音效
```

### 2.2 音效規範
```
技術規格：
- 格式：WAV 16-bit 44.1kHz
- BGM長度：2-4分鐘循環
- SE長度：0.1-2秒
- 音量標準：BGM -12dB，SE -6dB

觸發時機：
- 每次按鍵操作都有對應音效
- 戰鬥動作必須有音效回饋
- 重要事件 (升級、獲得道具) 需要特殊音效
```

## 3. 遊戲數值設計

### 3.1 角色屬性表
```
玩家等級成長 (1-10級)：
等級 | 生命值 | 魔力值 | 攻擊力 | 防禦力 | 所需經驗
-----|--------|--------|--------|--------|----------
  1  |   100  |   50   |   10   |    5   |     0
  2  |   120  |   60   |   12   |    6   |   100
  3  |   140  |   70   |   14   |    7   |   250
  4  |   160  |   80   |   16   |    8   |   450
  5  |   180  |   90   |   18   |    9   |   700
  6  |   200  |  100   |   20   |   10   |  1000
  7  |   220  |  110   |   22   |   11   |  1350
  8  |   240  |  120   |   24   |   12   |  1750
  9  |   260  |  130   |   26   |   13   |  2200
 10  |   300  |  150   |   30   |   15   |  2700

經驗值公式：nextExp = level * 50 + (level-1) * (level-1) * 25
```

### 3.2 武器數值表
```
武器屬性：
武器名稱    | 攻擊力 | 攻擊速度 | 擊退力 | 特殊效果
-----------|--------|----------|--------|----------
普通劍     |    8   |   快速   |    2   | 無
鐵劍       |   12   |   快速   |    3   | 無
斧頭       |   15   |   緩慢   |    5   | 可砍樹
十字鎬     |   10   |   中等   |    3   | 可破牆
火球法杖   |    6   |   中等   |    1   | 遠程攻擊

盾牌屬性：
盾牌名稱   | 防禦力 | 格擋率 | 特殊效果
-----------|--------|--------|----------
木盾       |    3   |   30%  | 無
鐵盾       |    5   |   50%  | 無
藍盾       |    8   |   70%  | 魔法抗性
```

### 3.3 怪物數值表
```
怪物屬性：
怪物名稱   | 生命值 | 攻擊力 | 防禦力 | 速度 | 經驗值 | 掉落物
-----------|--------|--------|--------|------|--------|--------
綠史萊姆   |   20   |    5   |    1   |  慢  |   10   | 金幣(1-3)
紅史萊姆   |   35   |    8   |    2   |  慢  |   15   | 金幣(2-5)
獸人       |   50   |   12   |    4   |  中  |   25   | 金幣(5-10)
蝙蝠       |   25   |    6   |    1   |  快  |   12   | 金幣(1-4)
骷髏領主   |  200   |   20   |   10   |  中  |  100   | 藍心
```

### 3.4 戰鬥計算公式
```
傷害計算：
基礎傷害 = 攻擊者攻擊力 - 防禦者防禦力
最終傷害 = max(1, 基礎傷害 * 隨機係數)
隨機係數 = 0.8 ~ 1.2 (±20%變動)

防護效果：
防護狀態下傷害 = 最終傷害 * 0.67 (減少33%)

格擋效果：
格擋成功：傷害 = 0，攻擊者被擊退
格擋失敗：正常受到傷害

擊退距離：
擊退距離 = 武器擊退力 * 2 瓦片
```

## 4. 地圖設計規範

### 4.1 世界地圖佈局
```
世界地圖 (50x50 瓦片)：
- 起始點：(25, 40) - 玩家出生位置
- 村莊區域：(20-30, 35-45) - NPC和商店
- 森林區域：(10-40, 10-30) - 怪物和資源
- 地下城入口：(45, 15) - 通往B1
- 湖泊：(5-15, 20-35) - 裝飾和障礙
- 山脈：(40-50, 5-20) - 自然邊界

重要位置座標：
- 老人NPC：(23, 37)
- 商人NPC：(27, 38)
- 地下城入口：(45, 15)
- 寶箱位置：(12, 25), (35, 12), (8, 42)
```

### 4.2 地下城設計
```
地下城B1 (30x30 瓦片)：
- 入口：(15, 28)
- 出口到B2：(15, 2)
- 怪物房間：4個房間，每個3-5隻怪物
- 寶箱房間：2個房間，包含裝備和道具
- 解謎房間：1個推石塊謎題

地下城B2 (25x25 瓦片)：
- 入口：(12, 23)
- Boss房間：(12, 5) - 骷髏領主
- 寶物房間：(12, 2) - 藍心 (遊戲結局道具)
- 機關房間：鐵門和壓力板謎題
```

### 4.3 解謎設計
```
推石塊謎題：
目標：將3個石塊推到對應的壓力板上
規則：
- 石塊只能推，不能拉
- 石塊推到牆邊會卡住
- 所有壓力板都被激活時，鐵門開啟
- 如果石塊卡住，切換場景可重置

解法：
1. 將左上石塊推到左側壓力板
2. 將右上石塊推到右側壓力板  
3. 將下方石塊推到中央壓力板
```

## 5. 劇情和對話設計

### 5.1 主線劇情大綱
```
第一章：冒險開始
- 玩家在村莊醒來，與老人對話了解背景
- 學習基本操作：移動、攻擊、互動
- 接受任務：尋找傳說中的藍心

第二章：探索世界
- 在世界地圖探索，與各種NPC互動
- 戰鬥系統教學：與史萊姆戰鬥
- 收集裝備和道具，提升角色能力

第三章：地下城冒險
- 進入地下城B1，面對更強的敵人
- 學習解謎機制：推石塊謎題
- 獲得更好的裝備，為Boss戰做準備

第四章：最終決戰
- 進入地下城B2，觸發過場動畫
- 與骷髏領主Boss戰，展現所有戰鬥技巧
- 獲得藍心，觸發結局動畫

第五章：完美結局
- 過場動畫展示冒險成果
- 感謝玩家的遊戲體驗
- 回到標題畫面
```

### 5.2 NPC對話腳本
```
老人 (初次對話)：
"年輕的冒險者，歡迎來到這個世界！"
"傳說在遙遠的地下城深處，藏著一顆神秘的藍心。"
"那是擁有無限力量的寶物，但也有可怕的守護者。"
"你願意接受這個挑戰嗎？"

商人對話：
"歡迎光臨！我這裡有最好的裝備！"
"[交易選單]"
"謝謝惠顧！祝你冒險順利！"

骷髏領主 (Boss戰開始)：
"愚蠢的人類..."
"沒有人能偷走我的寶藏！"
"準備迎接死亡吧！"

結局對話：
"恭喜你，勇敢的冒險者！"
"你成功獲得了傳說中的藍心。"
"你的冒險故事將被永遠傳頌..."
```

## 6. 開發里程碑規劃

### 6.1 開發階段劃分
```
MVP版本 (最小可行產品) - 2週：
✓ 基礎遊戲引擎 (遊戲循環、渲染)
✓ 玩家角色移動和動畫
✓ 簡單地圖和碰撞檢測
✓ 基礎UI (生命值顯示)

Alpha版本 - 4週：
✓ 戰鬥系統 (攻擊、受傷)
✓ 怪物AI和互動
✓ 背包和裝備系統
✓ 音效系統
✓ 存檔功能

Beta版本 - 6週：
✓ 完整地圖系統 (多場景)
✓ NPC和對話系統
✓ 解謎機制
✓ Boss戰和過場動畫
✓ 完整UI系統

Release版本 - 8週：
✓ 遊戲平衡調整
✓ 完整測試和除錯
✓ 效能優化
✓ 打包和部署
```

### 6.2 功能依賴關係
```
核心依賴：
遊戲引擎 → 所有其他功能
碰撞檢測 → 戰鬥系統、互動系統
實體系統 → 玩家、NPC、怪物
UI系統 → 對話、選單、狀態顯示

開發順序建議：
1. 遊戲引擎核心 (GamePanel, 遊戲循環)
2. 基礎實體系統 (Entity, Player)
3. 地圖和碰撞系統 (TileManager, CollisionChecker)
4. 輸入處理 (KeyHandler)
5. 戰鬥系統 (攻擊、受傷機制)
6. UI系統 (生命值、對話框)
7. 音效系統 (Sound)
8. 存檔系統 (SaveLoad)
9. 高級功能 (AI、解謎、過場動畫)
```

## 7. 程式碼實作範例

### 7.1 專案結構
```
src/main/java/gtcafe/rpg/
├── Main.java                    # 程式入口
├── GamePanel.java              # 遊戲核心引擎
├── UI.java                     # 使用者介面
├── AssetSetter.java           # 資源設定
├── entity/                     # 實體相關
│   ├── Entity.java            # 實體基礎類別
│   ├── Player.java            # 玩家類別
│   ├── NPC_OldMan.java        # NPC實作
│   └── monster/               # 怪物類別
├── system/                    # 系統功能
│   ├── KeyHandler.java        # 輸入處理
│   ├── CollisionChecker.java  # 碰撞檢測
│   ├── Sound.java             # 音效系統
│   └── Config.java            # 設定管理
├── tile/                      # 地圖系統
│   ├── TileManager.java       # 瓦片管理
│   └── Tile.java              # 瓦片類別
└── object/                    # 遊戲物件
    ├── SuperObject.java       # 物件基礎類別
    ├── OBJ_Key.java          # 鑰匙物件
    └── OBJ_Door.java         # 門物件
```

### 7.2 關鍵程式碼範例

#### 遊戲引擎初始化
```java
public class GamePanel extends JPanel implements Runnable {
    // 遊戲設定
    final int originalTileSize = 16;
    final int scale = 4;
    public final int tileSize = originalTileSize * scale;
    public final int maxScreenCol = 20;
    public final int maxScreenRow = 12;
    public final int screenWidth = tileSize * maxScreenCol;
    public final int screenHeight = tileSize * maxScreenRow;
    
    // 系統初始化
    public void setupGame() {
        assetSetter.setObject();
        assetSetter.setNPC();
        assetSetter.setMonster();
        assetSetter.setInteractiveTile();
        
        // 播放背景音樂
        playMusic(0);
        
        // 設定遊戲狀態
        gameState = titleState;
        
        // 建立暫存螢幕 (用於全螢幕模式)
        tempScreen = new BufferedImage(screenWidth, screenHeight, BufferedImage.TYPE_INT_ARGB);
        g2 = (Graphics2D)tempScreen.getGraphics();
        
        // 設定全螢幕
        if(fullScreenOn == true) {
            setFullScreen();
        }
    }
}
```

#### 實體基礎類別
```java
public abstract class Entity {
    GamePanel gp;
    public int worldX, worldY;
    public int speed;
    public BufferedImage up1, up2, down1, down2, left1, left2, right1, right2;
    public BufferedImage attackUp1, attackUp2, attackDown1, attackDown2, 
                         attackLeft1, attackLeft2, attackRight1, attackRight2;
    public String direction = "down";
    public int spriteCounter = 0;
    public int spriteNum = 1;
    
    // 碰撞檢測
    public Rectangle solidArea = new Rectangle(0, 0, 48, 48);
    public int solidAreaDefaultX, solidAreaDefaultY;
    public boolean collisionOn = false;
    
    // 戰鬥屬性
    public int maxLife;
    public int life;
    public int level;
    public int strength;
    public int dexterity;
    public int attack;
    public int defense;
    public int exp;
    public int nextLevelExp;
    public int coin;
    
    // 狀態
    public boolean invincible = false;
    public int invincibleCounter = 0;
    public boolean attacking = false;
    public int attackCounter = 0;
    
    public abstract void update();
    public abstract void draw(Graphics2D g2);
}
```

## 8. 測試計劃

### 8.1 功能測試用例
```
玩家移動測試：
TC001: 按W鍵，玩家向上移動
TC002: 按S鍵，玩家向下移動
TC003: 按A鍵，玩家向左移動
TC004: 按D鍵，玩家向右移動
TC005: 玩家碰到牆壁時停止移動

戰鬥系統測試：
TC006: 按空白鍵，玩家執行攻擊動作
TC007: 攻擊命中怪物，怪物血量減少
TC008: 怪物攻擊玩家，玩家血量減少
TC009: 玩家血量歸零，觸發遊戲結束
TC010: 怪物血量歸零，怪物消失並掉落經驗值

存檔系統測試：
TC011: 遊戲存檔成功，產生存檔檔案
TC012: 讀取存檔，玩家狀態正確恢復
TC013: 存檔檔案損壞時，顯示錯誤訊息
TC014: 多個存檔槽位正常運作
```

### 8.2 效能測試標準
```
幀率測試：
- 目標：穩定60 FPS
- 測試環境：Java 21, 8GB RAM
- 測試時長：連續遊戲30分鐘
- 通過標準：FPS不低於55，平均FPS > 58

記憶體測試：
- 初始記憶體使用：< 100MB
- 遊戲運行1小時後：< 200MB
- 無記憶體洩漏：長時間運行記憶體穩定

載入時間測試：
- 遊戲啟動時間：< 3秒
- 場景切換時間：< 1秒
- 存檔載入時間：< 2秒
```

### 8.3 相容性測試矩陣
```
作業系統相容性：
✓ Windows 10/11
✓ macOS 12+
✓ Ubuntu 20.04+

Java版本相容性：
✓ Java 21 (主要目標)
✓ Java 17 (向下相容)
✓ Java 11 (最低需求)

解析度測試：
✓ 1920x1080 (主要目標)
✓ 1366x768 (最低需求)
✓ 2560x1440 (高解析度)
✓ 全螢幕模式切換
```

## 9. 風險評估和解決方案

### 9.1 技術風險
```
風險1：Java Swing效能限制
影響：可能無法達到穩定60 FPS
解決方案：
- 實作視錐剔除，只渲染可見物件
- 使用物件池減少垃圾回收
- 優化圖像載入和快取機制

風險2：跨平台相容性問題
影響：在某些系統上可能無法正常運行
解決方案：
- 在多個平台進行測試
- 使用標準Java API，避免平台特定功能
- 提供不同平台的安裝指南

風險3：存檔系統資料損壞
影響：玩家進度丟失
解決方案：
- 實作多重備份機制
- 加入資料完整性檢查
- 提供存檔修復工具
```

### 9.2 開發風險
```
風險4：開發時程延遲
影響：無法按時完成專案
解決方案：
- 採用敏捷開發方法
- 定期檢視進度和調整計劃
- 優先實作核心功能

風險5：美術資源不足
影響：遊戲視覺效果不佳
解決方案：
- 使用開源像素藝術資源
- 建立簡單但一致的美術風格
- 專注於遊戲玩法而非視覺效果
```

## 10. 部署和維護

### 10.1 建置流程
```bash
# 1. 編譯專案
./gradlew clean build

# 2. 執行測試
./gradlew test

# 3. 產生可執行JAR
./gradlew jar

# 4. 建立發布包
./gradlew distZip

# 5. 驗證發布包
java -jar build/libs/ma-legend-2.16.0.jar
```

### 10.2 發布檢查清單
```
程式碼品質：
□ 所有測試通過
□ 程式碼審查完成
□ 無已知的嚴重錯誤
□ 效能測試通過

文件完整性：
□ README.md 更新
□ 版本號正確
□ 變更日誌更新
□ 使用手冊完整

發布準備：
□ JAR檔案可正常執行
□ 在目標平台測試通過
□ 檔案大小合理 (< 50MB)
□ 授權資訊正確
```

這份補充文件涵蓋了從無到有開發這個遊戲所需的關鍵實作細節。結合原有的產品規格書和技術設計文件，開發團隊應該能夠順利重新實作整個遊戲。